import{v as e,r as t,c as n,a as s}from"./vendor.50c841e6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const s=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const c=new URL(e,s);if(self[t].moduleMap[c])return n(self[t].moduleMap[c]);const r=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){i(new Error(`Failed to import: ${e}`)),o(a)},onload(){n(self[t].moduleMap[c]),o(a)}});document.head.appendChild(a)})),self[t].moduleMap={}}}("assets/");var o,i,c="_container_a1n7c_1",r="_rowContainer_a1n7c_5",a="_staticChunk_a1n7c_8",l="_moveChunk_a1n7c_19",u="_moveChunkContent_a1n7c_26",h="_player_a1n7c_35";(i=o||(o={})).PLAYER="PLAYER",i.FLOOR="FLOOR",i.BOX="BOX",i.POINT="POINT",i.WALL="WALL";const m=o.PLAYER,d=o.FLOOR,p=o.BOX,y=o.POINT,k=o.WALL,E=[[d,k,k,k,k,k,k,k,d],[d,k,d,m,y,y,y,k,d],[d,k,d,d,d,k,k,k,k],[k,k,k,p,d,d,d,d,k],[k,d,d,d,k,p,k,d,k],[k,d,p,d,k,d,d,d,k],[k,d,d,d,k,k,k,k,k],[k,k,k,k,k,d,d,d,d]];var L,x;(x=L||(L={}))[x.LEFT=37]="LEFT",x[x.UP=38]="UP",x[x.RIGHT=39]="RIGHT",x[x.DOWN=40]="DOWN",x[x.EXIST=27]="EXIST";class v{constructor(){this.x=1,this.y=1}}class w{constructor(t,n=new v){this.id=e(),this.type=o.WALL,this.isPoint=!1,this.isWalkable=!1,this.content=null,this.type=t,this.position=n,[o.PLAYER,o.FLOOR,o.BOX,o.POINT].includes(t)&&(this.isWalkable=!0),o.POINT===t&&(this.isPoint=!0),[o.PLAYER,o.BOX].includes(t)&&(this.content=new O(t,this.position))}}class O{constructor(t,n=new v){this.id=e(),this.type=t,this.position=n}get calcPosition(){return{x:80*(this.position.x-1),y:80*(this.position.y-1)}}}const P=(e,t)=>e.x===t.x&&e.y===t.y,f=(e,t)=>P(e.position,t.position),C=(e,t,n)=>{const s=(e,t)=>{var n;return null==(n=e[t.y-1])?void 0:n[t.x-1]};let o=null;const{x:i,y:c}=t;switch(n){case L.LEFT:console.log("LEFT"),o=s(e,{x:i-1,y:c});break;case L.RIGHT:console.log("RIGHT"),o=s(e,{x:i+1,y:c});break;case L.UP:console.log("UP"),o=s(e,{x:i,y:c-1});break;case L.DOWN:console.log("DOWN"),o=s(e,{x:i,y:c+1})}return o},R=e=>{const{chunk:n}=e,{type:s}=n,i={width:80,height:80};return t.createElement("div",{className:a,style:i},(e=>{switch(e){case o.WALL:return t.createElement("div",null,t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"));case o.POINT:return"O"}return""})(s))},g=e=>{const{chunk:s}=e,{type:i,calcPosition:c}=s,{x:r,y:a}=c,m={width:80,height:80,left:r,top:a};return t.createElement("div",{className:l,style:m},t.createElement("div",{className:n(u,i===o.PLAYER?h:"")},i))};class _{constructor(){this.gameBoard={width:0,height:0},this.staticChunks=[],this.scoreChunks=[],this.boxChunks=[],this.playerChunk=new O(o.PLAYER)}}const T=(e=E)=>{const t=new _;return t.gameBoard={width:80*e[0].length,height:80*e.length},t.staticChunks=e.map(((e,n)=>e.map(((e,s)=>{const i=new w(e,{x:s+1,y:n+1});return i.content&&(i.content.type===o.BOX?t.boxChunks.push(i.content):i.content.type===o.PLAYER&&(t.playerChunk=i.content)),i.isPoint&&t.scoreChunks.push(i),i})))),t},b=()=>{const e=t.useRef(!1),n=t.useCallback((()=>T(E)),[]),[s,i]=t.useState(n()),{staticChunks:c,scoreChunks:r,boxChunks:a,playerChunk:l}=s,[u,h]=t.useState(l),[m,d]=t.useState(a),p=t.useMemo((()=>[u,...m]),[u,m]);t.useEffect((()=>{h(l),d(a),e.current=!1}),[l,a]),((e=[],t)=>e.every((e=>t.some((t=>f(e,t))))))(r,m)&&!e.current&&(e.current=!0,setTimeout((()=>{confirm("你赢了!"),i(T(E))}),100));const y=t.useCallback((e=>{if(console.log(e),!Object.values(L).includes(e.keyCode))return;const t=e.keyCode;if(t===L.EXIST)return console.log("EXIST"),void i(T(E));const n=C(c,u.position,t);if(!n)return;if(!n.isWalkable)return;const s=m.find((e=>f(n,e))),r=new O(o.PLAYER,n.position);if(r.id=u.id,s){const e=C(c,s.position,t),i=!p.find((t=>f(e,t)));if(!e||!e.isWalkable||!i)return;const a=new O(o.BOX,e.position);h(r),d((e=>e.map((e=>P(e.position,n.position)?(a.id=e.id,a):e))))}else h(new O(o.PLAYER,n.position))}),[s,c,p]);return{status:t.useMemo((()=>({gameBoardStatus:s,staticChunks:c,moveChunks:p})),[s,c,p]),handlePlayerMove:y}},A=()=>{const{status:e,handlePlayerMove:n}=b(),{gameBoardStatus:s,staticChunks:o,moveChunks:i}=e,{gameBoard:a}=s,l={width:a.width,height:a.height};return t.useEffect((()=>(window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n))),[n]),t.createElement("div",{className:c,style:l},o.map(((e,n)=>t.createElement("div",{className:r,key:n},e.map(((e,n)=>t.createElement(R,{key:n,chunk:e})))))),i.map(((e,n)=>t.createElement(g,{key:n,chunk:e}))))};function I(){return t.createElement(A,null)}s.render(t.createElement(t.StrictMode,null,t.createElement(I,null)),document.getElementById("root"));
