import{v as e,r as t,c as n,a as s}from"./vendor.50c841e6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const s=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const r=new URL(e,s);if(self[t].moduleMap[r])return n(self[t].moduleMap[r]);const c=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){i(new Error(`Failed to import: ${e}`)),o(a)},onload(){n(self[t].moduleMap[r]),o(a)}});document.head.appendChild(a)})),self[t].moduleMap={}}}("assets/");var o,i,r="_container_1gdbp_1",c="_rowContainer_1gdbp_5",a="_staticChunk_1gdbp_8",l="_moveChunk_1gdbp_19",u="_moveChunkContent_1gdbp_27",h="_player_1gdbp_36";(i=o||(o={})).PLAYER="PLAYER",i.FLOOR="FLOOR",i.BOX="BOX",i.POINT="POINT",i.WALL="WALL";const d=o.PLAYER,m=o.FLOOR,p=o.BOX,y=o.POINT,k=o.WALL,E=[[m,k,k,k,k,k,k,k,m],[m,k,m,d,y,y,y,k,m],[m,k,m,m,m,k,k,k,k],[k,k,k,p,m,m,m,m,k],[k,m,m,m,k,p,k,m,k],[k,m,p,m,k,m,m,m,k],[k,m,m,m,k,k,k,k,k],[k,k,k,k,k,m,m,m,m]];var x,L;(L=x||(x={}))[L.LEFT=37]="LEFT",L[L.UP=38]="UP",L[L.RIGHT=39]="RIGHT",L[L.DOWN=40]="DOWN",L[L.EXIST=27]="EXIST";class v{constructor(){this.x=1,this.y=1}}class O{constructor(t,n=new v){this.id=e(),this.type=o.WALL,this.isPoint=!1,this.isWalkable=!1,this.content=null,this.type=t,this.position=n,[o.PLAYER,o.FLOOR,o.BOX,o.POINT].includes(t)&&(this.isWalkable=!0),o.POINT===t&&(this.isPoint=!0),[o.PLAYER,o.BOX].includes(t)&&(this.content=new w(t,this.position))}}class w{constructor(t,n=new v){this.id=e(),this.type=t,this.position=n}get calcPosition(){return{x:80*(this.position.x-1),y:80*(this.position.y-1)}}}const g=(e,t)=>e.x===t.x&&e.y===t.y,P=(e,t)=>g(e.position,t.position),f=(e,t,n)=>{const s=(e,t)=>{var n;return null==(n=e[t.y-1])?void 0:n[t.x-1]};let o=null;const{x:i,y:r}=t;switch(n){case x.LEFT:console.log("LEFT"),o=s(e,{x:i-1,y:r});break;case x.RIGHT:console.log("RIGHT"),o=s(e,{x:i+1,y:r});break;case x.UP:console.log("UP"),o=s(e,{x:i,y:r-1});break;case x.DOWN:console.log("DOWN"),o=s(e,{x:i,y:r+1})}return o},C=e=>{const{chunk:n}=e,{type:s}=n,i={width:80,height:80};return t.createElement("div",{className:a,style:i},(e=>{switch(e){case o.WALL:return t.createElement("div",null,t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"));case o.POINT:return"O"}return""})(s))},R=e=>{const{chunk:s}=e,{type:i,calcPosition:r}=s,{x:c,y:a}=r,d={width:80,height:80,left:c,top:a};return t.createElement("div",{className:l,style:d},t.createElement("div",{className:n(u,i===o.PLAYER?h:"")},i))};class b{constructor(){this.gameBoard={width:0,height:0},this.staticChunks=[],this.scoreChunks=[],this.boxChunks=[],this.playerChunk=new w(o.PLAYER)}}const _=(e=E)=>{const t=new b;return t.gameBoard={width:80*e[0].length,height:80*e.length},t.staticChunks=e.map(((e,n)=>e.map(((e,s)=>{const i=new O(e,{x:s+1,y:n+1});return i.content&&(i.content.type===o.BOX?t.boxChunks.push(i.content):i.content.type===o.PLAYER&&(t.playerChunk=i.content)),i.isPoint&&t.scoreChunks.push(i),i})))),t},T=()=>{const e=t.useRef(!1),n=t.useCallback((()=>_(E)),[]),[s,i]=t.useState(n()),{staticChunks:r,scoreChunks:c,boxChunks:a,playerChunk:l}=s,[u,h]=t.useState(l),[d,m]=t.useState(a),p=t.useMemo((()=>[u,...d]),[u,d]);t.useEffect((()=>{h(l),m(a),e.current=!1}),[l,a]),((e=[],t)=>e.every((e=>t.some((t=>P(e,t))))))(c,d)&&!e.current&&(e.current=!0,setTimeout((()=>{confirm("你赢了!"),i(_(E))}),100));const y=t.useCallback((e=>{if(console.log(e),!Object.values(x).includes(e.keyCode))return;const t=e.keyCode;if(t===x.EXIST)return console.log("EXIST"),void i(_(E));const n=f(r,u.position,t);if(!n)return;if(!n.isWalkable)return;const s=d.find((e=>P(n,e))),c=new w(o.PLAYER,n.position);if(s){const e=f(r,s.position,t),i=!p.find((t=>P(e,t)));if(!e||!e.isWalkable||!i)return;const a=new w(o.BOX,e.position);h(c),m((e=>e.map((e=>g(e.position,n.position)?a:e))))}else h(c)}),[s,r,p]);return{status:t.useMemo((()=>({gameBoardStatus:s,staticChunks:r,moveChunks:p})),[s,r,p]),handlePlayerMove:y}},I=()=>{const{status:e,handlePlayerMove:n}=T(),{gameBoardStatus:s,staticChunks:o,moveChunks:i}=e,{gameBoard:a}=s,l={width:a.width,height:a.height};return t.useEffect((()=>(window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n))),[n]),t.createElement("div",{className:r,style:l},o.map(((e,n)=>t.createElement("div",{className:c,key:n},e.map(((e,n)=>t.createElement(C,{key:n,chunk:e})))))),i.map(((e,n)=>t.createElement(R,{key:n,chunk:e}))))};function N(){return t.createElement(I,null)}s.render(t.createElement(t.StrictMode,null,t.createElement(N,null)),document.getElementById("root"));
