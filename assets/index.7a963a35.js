import{v as e,r as t,c as n,a as s}from"./vendor.50c841e6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const s=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,r)=>{const i=new URL(e,s);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const c=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){r(new Error(`Failed to import: ${e}`)),o(a)},onload(){n(self[t].moduleMap[i]),o(a)}});document.head.appendChild(a)})),self[t].moduleMap={}}}("assets/");var o,r,i="_container_1s89r_1",c="_rowContainer_1s89r_5",a="_staticChunk_1s89r_8",l="_moveChunk_1s89r_19",u="_moveChunkContent_1s89r_27",h="_player_1s89r_36",m="_description_1s89r_39",d="_stepCountBoard_1s89r_44";(r=o||(o={})).PLAYER="PLAYER",r.FLOOR="FLOOR",r.BOX="BOX",r.POINT="POINT",r.WALL="WALL";const p=o.PLAYER,E=o.FLOOR,y=o.BOX,k=o.POINT,v=o.WALL,x=[[E,v,v,v,v,v,v,v,E],[E,v,E,p,k,k,k,v,E],[E,v,E,E,E,v,v,v,v],[v,v,v,y,E,E,E,E,v],[v,E,E,E,v,y,v,E,v],[v,E,y,E,v,E,E,E,v],[v,E,E,E,v,v,v,v,v],[v,v,v,v,v,E,E,E,E]];var L,w;(w=L||(L={})).LEFT="ArrowLeft",w.UP="ArrowUp",w.RIGHT="ArrowRight",w.DOWN="ArrowDown",w.EXIST="Escape";class O{constructor(){this.x=1,this.y=1}}class _{constructor(t,n=new O){this.id=e(),this.type=o.WALL,this.isPoint=!1,this.isWalkable=!1,this.content=null,this.type=t,this.position=n,[o.PLAYER,o.FLOOR,o.BOX,o.POINT].includes(t)&&(this.isWalkable=!0),o.POINT===t&&(this.isPoint=!0),[o.PLAYER,o.BOX].includes(t)&&(this.content=new f(t,this.position))}}class f{constructor(t,n=new O){this.id=e(),this.type=t,this.position=n}get calcPosition(){return{x:80*(this.position.x-1),y:80*(this.position.y-1)}}}const P=(e,t)=>e.x===t.x&&e.y===t.y,g=(e,t)=>P(e.position,t.position),C=(e,t,n)=>{const s=(e,t)=>{var n;return null==(n=e[t.y-1])?void 0:n[t.x-1]};let o=null;const{x:r,y:i}=t;switch(n){case L.LEFT:console.log("LEFT"),o=s(e,{x:r-1,y:i});break;case L.RIGHT:console.log("RIGHT"),o=s(e,{x:r+1,y:i});break;case L.UP:console.log("UP"),o=s(e,{x:r,y:i-1});break;case L.DOWN:console.log("DOWN"),o=s(e,{x:r,y:i+1})}return o},R=e=>{const{chunk:n}=e,{type:s}=n,r={width:80,height:80};return t.createElement("div",{className:a,style:r},(e=>{switch(e){case o.WALL:return t.createElement("div",null,t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"),t.createElement("div",null,"xxxxxx"));case o.POINT:return"O"}return""})(s))},A=e=>{const{chunk:s}=e,{type:r,calcPosition:i}=s,{x:c,y:a}=i,m={width:80,height:80,left:c,top:a};return t.createElement("div",{className:l,style:m},t.createElement("div",{className:n(u,r===o.PLAYER?h:"")},r))};class b{constructor(){this.gameBoard={width:0,height:0},this.staticChunks=[],this.scoreChunks=[],this.boxChunks=[],this.playerChunk=new f(o.PLAYER)}}const N=(e=x)=>{const t=new b;return t.gameBoard={width:80*e[0].length,height:80*e.length},t.staticChunks=e.map(((e,n)=>e.map(((e,s)=>{const r=new _(e,{x:s+1,y:n+1});return r.content&&(r.content.type===o.BOX?t.boxChunks.push(r.content):r.content.type===o.PLAYER&&(t.playerChunk=r.content)),r.isPoint&&t.scoreChunks.push(r),r})))),t},T=N(),B=()=>{const e=t.useRef(!1),[n,s]=t.useState(T),{staticChunks:r,scoreChunks:i,boxChunks:c,playerChunk:a}=n,[l,u]=t.useState(a),[h,m]=t.useState(c),[d,p]=t.useState(0),E=t.useMemo((()=>[l,...h]),[l,h]);t.useEffect((()=>{u(a),m(c),p(0),e.current=!1}),[a,c,n]),((e=[],t)=>e.every((e=>t.some((t=>g(e,t))))))(i,h)&&!e.current&&(console.log("game end"),e.current=!0,Promise.resolve().then((()=>{s(N(x))})),setTimeout((()=>{confirm("你赢了!")}),500));const y=t.useCallback((e=>{if(console.log(e),!Object.values(L).includes(e.code))return;const t=e.code;if(t===L.EXIST)return console.log("EXIST"),void s(N(x));const n=C(r,l.position,t);if(!n)return;if(!n.isWalkable)return;const i=h.find((e=>g(n,e))),c=new f(o.PLAYER,n.position);if(i){const e=C(r,i.position,t),s=!E.find((t=>g(e,t)));if(!e||!e.isWalkable||!s)return;const a=new f(o.BOX,e.position);u(c),m((e=>e.map((e=>P(e.position,n.position)?a:e)))),p((e=>e+1))}else u(c),p((e=>e+1))}),[n,r,E]);return{status:t.useMemo((()=>({gameBoardStatus:n,staticChunks:r,moveChunks:E})),[n,r,E]),handlePlayerMove:y,steps:d}},I=()=>{const{status:e,handlePlayerMove:n,steps:s}=B(),{gameBoardStatus:o,staticChunks:r,moveChunks:a}=e,{gameBoard:l}=o,u={width:l.width,height:l.height};return t.useEffect((()=>(window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n))),[n]),t.createElement("div",{className:i,style:u},t.createElement("div",{className:d},"步数: ",s),r.map(((e,n)=>t.createElement("div",{className:c,key:n},e.map(((e,n)=>t.createElement(R,{key:n,chunk:e})))))),a.map(((e,n)=>t.createElement(A,{key:n,chunk:e}))))},W=()=>t.createElement("div",{className:m},"游戏说明:",t.createElement("div",null,"按方向键可移动玩家,玩家可以推动一个箱子"),t.createElement("div",null,"得分点O全部放上箱子即可过关"),t.createElement("div",null,"按esc可重置游戏"));function F(){return t.createElement(t.Fragment,null,t.createElement(W,null),t.createElement(I,null))}s.render(t.createElement(t.StrictMode,null,t.createElement(F,null)),document.getElementById("root"));
